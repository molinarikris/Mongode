var mongo=require("mongodb").MongoClient,q=require("deferred"),dbConfig=function(a,b,c){var d,e;if(this.count=0,"string"==typeof a&&"string"==typeof b)if(e=a,d=b,c)var f={hostname:c.hostname||"localhost",port:c.port||"27017",uri_decode_auth:c.uri_decode_auth||!1,db:c.db||null,server:c.server||null,replSet:c.replSet||null,mongos:c.mongos||null,promiseLibrary:c.promiseLibrary||null};else var f={hostname:"localhost",port:"27017"};else{if("object"!=typeof a||!a.colName||!a.dbName)throw new Error("Mongode: constructor requires a database and collection name passed as a single object \nrequire('mongode2')({\ndbName: 'your db name',\ncolName: 'your collection name'\n})\n or as two string parameters followed by an optional options object.\n require('mongode2')('your db name', 'your collection name')\nI didn't quite get that.");var f={hostname:a.hostname||"localhost",port:a.port||"27017",uri_decode_auth:a.uri_decode_auth||!1,db:a.db||null,server:a.server||null,replSet:a.replSet||null,mongos:a.mongos||null,promiseLibrary:a.promiseLibrary||null};d=a.colName,e=a.dbName}return{connection:function(a){var b=this;mongo.connect("mongodb://"+f.hostname+":"+f.port+"/"+e,f,function(c,e){c?a(c):e.collection(d).count({},function(c,d){b.count=d,a(null,e)})})},read:function(a,b){this.connection(function(c,e){c?b(c):"object"==typeof a&&a?e.collection(d).find(a).toArray(function(a,c){a?b(a):b(null,c)}):"function"==typeof a?e.collection(d).find().toArray(function(b,c){b?a(b):a(null,c)}):e.collection(d).find().toArray(function(a,c){a?b(a):b(null,c)})})},create:function(a,b){var c=q(),e=this;return this.connection(function(f,g){f?b(f):b?g.collection(d).insert(a,function(c,d){a.length?e.count+=a.length:e.count++,c?b(c):b(null,d)}):g.collection(d).insert(a,function(b,d){b?c.reject(b):(a.length?e.count+=a.length:e.count++,c.resolve(d))})}),c.promise},"delete":function(a,b){this.connection(function(c,e){c?b(c):b||"function"!=typeof a?"object"==typeof a&&a&&"function"==typeof b&&e.collection(d).remove(a,function(a,c){a?b(a):b(null,c)}):a(new Error("You cannot use delete without a valid query"))})},update:function(a,b,c,e){this.connection(function(f,g){var h;f?e(f):"function"==typeof c?(h={upsert:!1,multi:!0},g.collection(d).update(a,b,h,function(a,b){a?c(a):c(null,b)})):(h={upsert:c.upsert||!1,multi:c.multi||!0},g.collection(d).updateOne(a,b,h,function(a,b){a?e(a):e(null,b)}))})},aggregate:function(a,b,c){this.connection(function(b,e){e.collection(d).aggregate(a,function(a,b){a?c(a):c(null,b)})})}}};module.exports=dbConfig;